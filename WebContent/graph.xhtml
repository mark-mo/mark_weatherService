<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"> 
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:h="http://java.sun.com/jsf/html"> 

<h:head>
	<title>Graph</title>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
	<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</h:head> 
<body> 
	<h1>Weather Pi</h1>
	<h2>Graph</h2>
	
	<div id="tester" style="width:1200px; height:700px;"></div>
	<p><a href="index.html">return home</a></p>
	
	<script>
		var humidityTrace = {
			type: "scatter",
			mode: "lines",
			name: "Humidity",
			x: [],
			y: [],
			line: {color: "#303030"}
		}
		
		var pressureTrace = {
			type: "scatter",
			mode: "lines",
			name: "Pressure",
			yaxis: "y2",
			x: [],
			y: [],
			line: {color: "#bfb36a"}
		}
		
		function plot() {
			var data = [humidityTrace, pressureTrace]
			
			var layout = {
				title: 'Weather Readings',
				font: {family: "'RingsideCompressed-Book', sans-serif", size: 16},
				yaxis: {
					title: "Humidity (%)",
				},
				yaxis2: {
					title: "Air Pressure (mbar)",
					titlefont: {color: "#bfb36a"},
					tickfont: {color: "#bfb36a"},
					gridcolor: "#f6efc3",
					overlaying: "y",
					side: "right"
				}
			}
			
			Plotly.newPlot('tester', data, layout)
		}
		
		// JSON received
		function responseSuccess(data) {
			console.log("REST call returned success!")
			console.log(JSON.stringify(data))
			
			for (let reading of data.data) {
				// Push time and humidity to humidity line graph
				humidityTrace.x.push(reading.time)
				humidityTrace.y.push(reading.firstAtt)
				
				// Push time and pressure to pressure line graph
				pressureTrace.x.push(reading.time)
				pressureTrace.y.push(reading.secondAtt)
			}
			
			plot()
		}
	
		// When REST call returns error
		function responseError(request, error) {
			console.log("ERROR. Request: " + JSON.stringify(request))
		}
	
		// Make AJAX call with provided link
		function sendRequest() {
			$.ajax({
				url: 'http://localhost:8080/WeatherApp/rest/weather/readings',
				crossDomain: true,
				type: 'GET',
				success: responseSuccess,
				error: responseError
			})
		}
		
		// Actually do anything
		sendRequest()
	</script>
</body> 
</html>
